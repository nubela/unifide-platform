// Generated by CoffeeScript 1.6.2
(function() {
  var capitaliseFirstLetter;

  this.ORDER_VIEW = {
    UPDATE: "order_view_update",
    OVERVIEW: "order_view_overview",
    DETAILS: "order_view_details",
    DETAILS_FILTERED: "order_view_details_filtered"
  };

  this.ORDER_SESSION = {
    OBJ_ID: "order_obj_id",
    VIEW_TYPE: "order_view_type"
  };

  this.ORDER_TEMPLATE = {
    OVERVIEW: "order_table",
    UPDATE: "order_update",
    DETAILS: "order_details"
  };

  Template.order.view = function() {
    if ((Session.get(ORDER_SESSION.VIEW_TYPE)) === ORDER_VIEW.UPDATE) {
      return Template[ORDER_TEMPLATE.UPDATE]();
    } else if ((Session.get(ORDER_SESSION.VIEW_TYPE)) === ORDER_VIEW.DETAILS) {
      return Template[ORDER_TEMPLATE.DETAILS]();
    } else {
      return Template[ORDER_TEMPLATE.OVERVIEW]();
    }
  };

  Template.order_table.orders = function() {
    var formatted_lis, orders;

    orders = ORDERObj.find({}, {
      limit: 10
    }).fetch();
    formatted_lis = [];
    _.each(orders, function(order) {
      return formatted_lis.push({
        id: order._id,
        date: capitaliseFirstLetter(humanize.naturalDay(order.timestamp_utc)),
        user_name: order.user.first_name + " " + order.user.last_name,
        item_name: order.object.name
      });
    });
    return formatted_lis;
  };

  Template.order_table.rendered = function() {
    return $(".order-action").tooltip({
      placement: "top"
    });
  };

  Template.order_table.tag = function() {
    return null;
  };

  Template.order_table.events = {
    "mouseenter .order-entry": function(evt) {
      var order_action, target;

      target = evt.target;
      order_action = $(target).find(".order-action");
      return _.each(order_action, function(anchor) {
        $(anchor).removeClass("btn-disabled");
        return $(anchor).addClass("btn-primary");
      });
    },
    "mouseleave .order-entry": function(evt) {
      var order_action, target;

      target = evt.target;
      order_action = $(target).find(".order-action");
      return _.each(order_action, function(anchor) {
        $(anchor).removeClass("btn-primary");
        return $(anchor).addClass("btn-disabled");
      });
    }
  };

  capitaliseFirstLetter = function(string) {
    return string.charAt(0).toUpperCase() + (string.slice(1));
  };

  this.init_orders = function() {
    return Meteor.call("get_all_orders", function(error, content) {
      return _.each(content.orders, function(order) {
        return ORDERObj.insert(order);
      });
    });
  };

}).call(this);
